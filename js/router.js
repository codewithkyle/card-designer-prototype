var c=class{constructor(){this.hijackPopstate=e=>{e.state?.url&&this.route(e.state.url,"replace")},this.hijackClick=e=>{if(e.target instanceof HTMLAnchorElement&&e.target.target!=="_blank"&&e.target.getAttribute("href")){e.preventDefault(),e.stopPropagation();let t=e.target.getAttribute("href"),i=e.target.getAttribute("history");i==="push"||i==="replace"?this.route(t,i):this.route(t)}},this.router={},this.mountingPoint=document.body,this.modules={}}configure(e){this.router={};for(let t in e)this.router[t.replace(/^\/|\/$/g,"")]=e[t];this.route(location.href,"replace"),document.addEventListener("click",this.hijackClick,{capture:!0}),window.addEventListener("popstate",this.hijackPopstate)}mount(e){this.mountingPoint=e}navigateTo(e,t="push"){e.indexOf(location.origin)===0||e.indexOf("/")===0?this.route(e,t):location.href=e}pageJump(e,t="smooth"){let i=document.body.querySelector(`#${e.replace(/^\#/,"")}`);i&&i.scrollIntoView({behavior:t,block:"center",inline:"center"}),this.replaceState(`${location.origin}${location.pathname}${e}`)}replaceState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.replaceState({url:e},document.title,`${location.origin}/${e}`)}pushState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.pushState({url:e},document.title,`${location.origin}/${e}`)}mountElement(e,t,i){this.mountingPoint?.firstElementChild?.remove(),this.mountingPoint.appendChild(e),i==="replace"?this.replaceState(`${location.origin}/${t}`):this.pushState(`${location.origin}/${t}`)}async importModule(e){let t=null;try{t=await import(e)}catch(i){console.error(i)}return t}parseTokens(e,t){let i={};e=e.replace(/\?.*/,"").trim();let o=e.split("/");t=t.replace(/^\/|\/$/g,"").trim();let l=t.split("/");for(let r=0;r<l.length;r++)if(l[r].indexOf("{")===0&&l[r].indexOf("}")===l[r].length-1){let a=l[r].replace(/^\{|\}$/g,"").trim();i[a]=o[r]}return i}parseGetParams(e){let t={},i=e.match(/\?.*/)?.[0]??null;if(!i)return t;let o=new URLSearchParams(i);return o.forEach((l,r)=>{if(!t?.[r]){let a=o.getAll(r);a.length>1?t[r]=a:t[r]=a[0]}}),t}async import(e,t,i){if(e===null)throw"Missing route data.";let o=null,l=null;typeof e=="string"?(o=e,l=`./${e}.js`):(o=e.tagName,l=e.file);let r=this.parseTokens(t,i),a=this.parseGetParams(t);if(o===null||l===null)throw"Missing route data.";if(this.modules?.[o])return new this.modules[o].default(r,a);let n=await this.importModule(l);if(n===null)throw"Failed to dynamically import module.";if(!n?.default){let u=Object.keys(n)?.[0]??null;if(!u)throw"ES Module is exporting an empty object.";n=Object.assign({default:n[u]},n)}return this.modules[o]=n,customElements.get(o)||customElements.define(o,n.default),new this.modules[o].default(r,a)}lookupRoute(e){let t=null;console.log(e),e=e.replace(/\?.*|\#.*/g,"").replace(/^\/|\/$/g,"").trim();let i=e.split("/");for(let o in this.router){let l=o.split("/");if(l.length===i.length){let r=!0;for(let a=0;a<l.length;a++){let n=l[a].trim().toLowerCase();if(n==="*")break;if(!(n.indexOf("{")===0&&n.indexOf("}")===n.length-1)&&n!==i[a].trim().toLowerCase()){r=!1;break}}if(r){t=o;break}}}return t}async route(e,t="push"){if(e=e.replace(location.origin,"").replace(/^\/|\/$/g,"").trim(),e.indexOf("#")===0)this.pageJump(e);else{document.documentElement.setAttribute("router","loading");let i=null;this.router?.[e]?i=e:i=this.lookupRoute(e),i===null&&this.router?.["404"]&&(e="404",i=e);try{let o=await this.import(this.router[i],e,i);this.mountElement(o,e,t),e.indexOf("#")!==-1?this.pageJump(e.match(/\#.*/)[0],"auto"):o.scrollIntoView({block:"start",inline:"start",behavior:"auto"})}catch(o){console.error(o),location.href=`${location.origin}/404`}document.documentElement.setAttribute("router","idling")}}},s=new c,h=s.navigateTo.bind(s),p=s.configure.bind(s),m=s.mount.bind(s),g=s.pageJump.bind(s),d=s.replaceState.bind(s),f=s.pushState.bind(s);export{p as configure,m as mount,h as navigateTo,g as pageJump,f as pushState,d as replaceState};
